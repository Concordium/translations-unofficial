.. _`Network Dashboard`: https://dashboard.testnet.concordium.com/
.. _Discord: https://discord.gg/xWmQ5tp

=============
Запуск ноды
=============

.. contents::
   :local:
   :backlinks: none

В этом руководстве вы узнаете, как запустить ноду на вашем компьютере, входящем в сеть Concordium. Это означает, что вы получаете блоки и транзакции от других нод, а также распространяете информацию о блоках и транзакциях на ноды сети Concordium. Следуя этому руководству, вы сможете

-  запустите ноду Concordium
-  наблюдать за ней на панели мониторинга и
-  запрашивать состояние блокчейна Concordium непосредственно с вашего компьютера.

Вам не нужна учетная запись для запуска ноды.

Прежде чем начать
==================

Перед запуском узла Concordium вам необходимо

1. Установить и запустить Docker.

   -  В *Linux*, разрешите запускать Docker от имени пользователя, не являющегося пользователем root..

2. Скачать и распаковать программу :ref:`concordium-node-and-client-download`.

Обновление с более ранней версии Open Testnet
===============================================

Для обновления программного обеспечения Concordium до текущей версии Open Testnet 4:

-  Выполните описанные выше действия, чтобы :ref:`download<downloads>` самое последнее программное обеспечение Concordium.

-  Запустите исполняемый файл ``concordium-node-reset-data`` из распакованного архива.

   -  Для пользователей *Mac*: при первом открытии инструмента щелкните правой кнопкой мыши файл
      ``concordium-node-reset-data`` и выберите **Открыть**.Появится сообщение о том, что программное обеспечение от неизвестного разработчика. Снова выберите
      **Открыть** ain.
   -  Для пользователей *Windows*: при первом открытии инструмента дважды щелкните файл ``concordium-node-reset-data``. Появится сообщение о том, что программное обеспечение от неизвестного разработчика. Выберите **Дополнительная информация** → **Run Запустить в любом случае**.

-  Инструмент спросит:

      *Вы также хотите удалить сохраненные ключи?*

   Учетные записи, созданные для предыдущих версий, больше не действительны в Open Testnet 3. Поэтому, если у вас есть сохраненные учетные записи из предыдущих версий, мы рекомендуем ввести
   **y** что удалит все ключи учетной записи.

Запуск ноды
==============

Чтобы запустить клиент, который присоединится к Open Testnet, выполните следующие действия:
1. Откройте исполняемый файл ``concordium-node`` из распакованного архива.

-  Для пользователей *Mac*: при первом открытии инструмента щелкните правой кнопкой мыши файл
   ``concordium-node`` и выберите **Открыть**.
   Появится сообщение о том, что программное обеспечение от неизвестного разработчика. Снова выберите **Открыть**.
-  Для пользователей *Windows*: при первом открытии инструмента дважды кликните по файлу ``concordium-node``. Появится сообщение о том, что программное обеспечение от неизвестного разработчика. Выберите **Дополнительная информация** →  **Запустить в любом случае**.
-  При *restarting* нода подразумевает возможность использования опции
   ``--no-block-state-import``. Это позволит загрузить только те обновления блокчейна Concordium, которые произошли, когда нода была неактивна, что может ускорить процесс загрузки.

2. Введите имя для вашей ноды. Это имя будет отображаться на публичной панели.

3. Если вы уже запускали инструмент раньше, вас спросят, хотите ли вы удалить базу данных локальной ноды перед запуском. Нажатие кнопки **y** удалит и впоследствии воссоздаст информацию о состоянии блокчейна Concordium, которая была сохранена на вашем компьютере. **Обратите внимание, что удаление базы данных локальной ноды означает, что вашей ноде потребуется больше времени для актуализации данных с сетью Concordium**

Теперь инструмент загрузит образ клиента Concordium и загрузит его в Docker. Клиент запустит и начнет выводить логи работы ноды.

Просмотр своей ноды в панели
=================================

После запуска ``concordium-node``  вы можете

-  видеть свою ноду на `Network Dashboard`_
-  :ref:`запрашивать<testnet-query-node>` информацию о блоках, транзакциях и учетных записях

Сетевая панель мониторинга
----------------------------

Клиенту потребуется некоторое время, чтобы актуализировать состояние в соответствии с блокчейн Concordium. Это включает в себя, например, загрузку информации обо всех блоках в цепочке.

Помимо прочего, на `Network Dashboard`_ вы можете получить информацию о том, сколько времени потребуется вашей ноде, чтобы актуализироваться с цепочкой. Для этого вы можете сравнить значение
**длины** ноды (количество блоков, полученных вашей нодой) со значением **Chain Len** (количество блоков в самой длинной цепочке сети), которое отображается в верхней части панели мониторинга.


Активация входящих подключений
===============================

Если вы используете свой узел под брандмауэром или роутером, то вы сможете подключаться к другим нодам, но другие ноды не смогут инициировать подключения к вашей. Это совершенно нормально, и ваша нода будет полноценно участвовать в сети Concordium. Она сможет отправлять транзакции, а также,
:ref:`если подобное настроено<become-a-baker>`, переводить в bake и завершать их.

Однако вы можете сделать свою ноду еще лучше, активировав входящие соединения. По умолчанию ``concordium-node`` слушает порт 8888 для входящих подключений. В зависимости от конфигурации вашей сети и платформы, вам нужно будет либо перенаправить внешний порт на 8888 на вашем маршрутизаторе, либо открыть его в брандмауэре, либо сделать и то, и то одновременно. Детали реализации будут зависеть от вашей конфигурации.

Настройка портов
-----------------

Нода слушает четыре порта, которые можно настроить, подставив соответствующие аргументы в командной строке при запуске ноды. Порты, используемые нодой:

-  8888, порт для peer-to-peer сети, который может быть установлен с помощью
   ``--listen-node-port``
-  8082, порт используемый промежуточным программным обеспечением, которое можно установить с помощью  ``--listen-middleware-port``
-  10000, порт gRPC, который можно установить с помощью ``--listen-grpc-port``

При изменении отображений над контейнером docker его необходимо остановить (:ref:`stop-a-node`),
сбросить и запустить снова. Для сброса контейнера используйте
``concordium-node-reset-data`` либо запустите ``docker rm concordium-client`` в терминале.

Мы *настоятельно рекомендуем* настроить брандмауэр таким образом, чтобы он разрешал публичные соединения только на порту 8888 ( сетевой порт peer-to-peer). Кто либо, имеющий доступ к другим портам, может взять под контроль вашу ноду или учетные записи, которые вы сохранили на этой ноде.

Остановка ноды
=================

Чтобы остановить ноду, нажмите **CTRL+c**, и дождитесь, пока нода полностью завершит работу.

Если вы случайно закроете окно без явного выключения клиента, процесс будет продолжать работать в фоновом режиме в Docker. В этом случае используйте
``concordium-node-stop`` так же, как при открытии исполняемого файла ``concordium-node``.

Поддержка и обратная связь
============================

Данные логов вашей ноды можно получить с помощью инструмента
``concordium-node-retrieve-logs``. Это позволит сохранить логи из запущенного образа в файл. Кроме того, при наличии разрешения он будет извлекать информацию о программах, запущенных в данный момент в системе.

Вы можете отправить свои логи, системную информацию, вопросы и отзывы по адресу
testnet@concordium.com. Вы также можете связаться с нами в `Discord`_, или ознакомиться с :ref:`troubleshooting page<troubleshooting-and-known-issues>`

